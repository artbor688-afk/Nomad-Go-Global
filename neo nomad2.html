<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„Nomad Go Global</title>
    <link rel="website icon" type="png" href="ğŸ„">
    <!-- ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Leaflet (2D ĞºĞ°Ñ€Ñ‚Ğ°) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    
    <!-- ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Globe.GL (3D Ğ“Ğ»Ğ¾Ğ±ÑƒÑ) -->
    <script src="https://unpkg.com/globe.gl@2.28.1/dist/globe.gl.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;900&display=swap');
        
        /* ĞĞ±Ñ‰Ğ¸Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ */
        body { 
            font-family: 'Montserrat', sans-serif; 
            background: #011420; 
            color: #1e293b; 
            margin: 0; 
            overflow-x: hidden; /* Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºÑƒ */
            overflow-y: auto;   /* Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ°ĞµĞ¼ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½ÑƒÑ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºÑƒ */
        }
        
        /* === Ğ¡Ğ¢Ğ˜Ğ›Ğ˜ Ğ”Ğ›Ğ¯ Ğ¡ĞĞ•Ğ“Ğ === */
        #snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .tiny-emoji { position: absolute; opacity: 0.15; animation: float-around 15s infinite ease-in-out; user-select: none; }
        @keyframes float-around { 0%, 100% { transform: translate(0, 0) rotate(0deg); } 33% { transform: translate(15px, -20px) rotate(10deg); } 66% { transform: translate(-10px, 10px) rotate(-10deg); } }

        /* === Ğ¡Ğ¢Ğ˜Ğ›Ğ˜ Ğ”Ğ›Ğ¯ NOMAD GO (Ğ’Ğ•Ğ Ğ¥ĞĞ¯Ğ¯ Ğ§ĞĞ¡Ğ¢Ğ¬) === */
        #map { height: 450px; width: 100%; border-radius: 30px; border: 6px solid #fff; background: #e2e8f0; box-shadow: 0 10px 40px rgba(59, 130, 246, 0.2); position: relative; z-index: 10; }
        .glass-card { background: rgba(255, 255, 255, 0.952); backdrop-filter: blur(15px); border: 1px solid rgba(1, 2, 31, 0.8); border-radius: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,0.05); position: relative; z-index: 10; }
        .cat-btn { transition: 0.3s; opacity: 0.7; cursor: pointer; font-size: 9px; font-weight: 900; text-transform: uppercase; padding: 10px; border-radius: 12px; color: rgb(255, 255, 255); }
        .cat-btn.active { opacity: 1; border: 2px solid #1e293b; transform: scale(1.05); }
        .btn-main { background: linear-gradient(45deg, #3b82f6, #1d4ed8); box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3); color: white; }
        .map-label { color: #1e293b; padding: 4px 10px; border-radius: 10px; font-weight: 900; font-size: 10px; border: 2px solid #1e293b; background: white; white-space: nowrap; }
        .leaflet-control-attribution, .leaflet-routing-container { display: none !important; }
        h1.nomad-title { background: linear-gradient(to bottom, #fff 20%, #3b82f6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; position: relative; z-index: 10; }

        /* Ğ¡Ñ‚Ğ¸Ğ»Ğ¸ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ */
        .user-avatar-img { width: 60px; height: 60px; border-radius: 50%; border: 3px solid #ef4444; background-size: cover; background-position: center; box-shadow: 0 0 20px rgba(239, 68, 68, 0.8); position: relative; transition: transform 0.3s; }
        .char-name-tag { position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%); background: #ef4444; color: white; font-size: 9px; padding: 2px 8px; border-radius: 10px; font-weight: 900; white-space: nowrap; text-shadow: 1px 1px 2px black; }
        .avatar-container::before { content: ''; position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px; border-radius: 50%; border: 2px solid #3b82f6; animation: pulse-ring 1.5s infinite; }
        @keyframes pulse-ring { 0% { transform: scale(0.9); opacity: 1; } 100% { transform: scale(1.4); opacity: 0; } }

        /* === Ğ¡Ğ¢Ğ˜Ğ›Ğ˜ Ğ”Ğ›Ğ¯ Ğ“Ğ›ĞĞ‘Ğ£Ğ¡Ğ (ĞĞ˜Ğ–ĞĞ¯Ğ¯ Ğ§ĞĞ¡Ğ¢Ğ¬) === */
        #globe-section {
            position: relative;
            width: 100%;
            height: 100vh; /* Ğ“Ğ»Ğ¾Ğ±ÑƒÑ Ğ½Ğ° Ğ²ĞµÑÑŒ ÑĞºÑ€Ğ°Ğ½ */
            background: black;
            border-top: 5px solid #000000;
            margin-top: 50px;
        }

        #globe-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(9, 34, 148, 0.95);
            padding: 20px;
            border-radius: 12px;
            width: 280px;
            box-shadow: 0 4px 15px rgb(255, 255, 255);
            font-family: sans-serif;
            color: white;
        }
        
        #globe-controls h3 { margin-top: 0; text-align: center; color: white; }
        
        #globe-controls select, #globe-controls button { 
            width: 100%; 
            padding: 12px; 
            margin-top: 10px; 
            border-radius: 5px; 
            font-size: 16px;
            box-sizing: border-box;
        }
        
        #globe-controls select { color: black; }

        #globe-controls button { 
            background: #ffffff; 
            color: rgb(0, 0, 0); 
            border: none; 
            cursor: pointer; 
            font-weight: bold; 
            transition: 0.3s;
        }
        #globe-controls button:hover { background: #ccc; }
        #globe-controls button:disabled { background: #555; cursor: not-allowed; }

        #status-msg { text-align: center; font-weight: bold; margin-bottom: 10px; padding: 5px; border-radius: 4px; background: #eee; color: black; }
        
        #globeViz { width: 100%; height: 100%; }
    </style>
</head>
<body class="p-0">

    <!-- Ğ¤ĞĞĞĞ’Ğ«Ğ™ Ğ¡ĞĞ•Ğ“ -->
    <div id="snow-container"></div>

    <!-- ============================================== -->
    <!-- Ğ§ĞĞ¡Ğ¢Ğ¬ 1: NOMAD GO (2D ĞšĞĞ Ğ¢Ğ) -->
    <!-- ============================================== -->
    <div class="max-w-7xl mx-auto relative z-10 p-4 md:p-6">
        <header class="text-center mb-6">
            <h1 class="nomad-title text-4xl font-black italic uppercase tracking-tight">
                Neo Nomad â„ï¸
            </h1>
            <p class="text-blue-200 text-xs font-bold uppercase mt-2">Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4 space-y-4">
                <div class="glass-card p-6 shadow-2xl border-t-4 border-blue-400">
                    <div class="space-y-4">
                        <div class="relative">
                            <label class="text-[10px] font-black uppercase text-gray-400 ml-1">Ğ¡Ñ‚Ğ°Ñ€Ñ‚:</label>
                            <input id="startInput" type="text" class="w-full p-4 bg-white/50 border border-blue-100 rounded-2xl outline-none text-sm text-slate-800" placeholder="ĞÑ‚ĞºÑƒĞ´Ğ°?">
                            <button id="gpsBtn" onclick="toggleGPS()" class="absolute right-2 top-8 bg-blue-500 p-2 rounded-xl text-white">ğŸ›°ï¸</button>
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-gray-400 ml-1">Ğ¤Ğ¸Ğ½Ğ¸Ñˆ:</label>
                            <input id="endInput" type="text" class="w-full p-4 bg-white/50 border border-blue-100 rounded-2xl outline-none text-sm text-slate-800" placeholder="ĞšÑƒĞ´Ğ° ĞµĞ´ĞµĞ¼?">
                        </div>
                    </div>

                    <div class="mt-6 grid grid-cols-3 gap-2">
                        <button onclick="toggleCat('tourism', 'Ğ“Ğ˜Ğ”', '#3b82f6', this)" class="cat-btn active bg-blue-500">ğŸ›ï¸ Ğ“Ğ¸Ğ´</button>
                        <button onclick="toggleCat('hotel', 'Ğ¡ĞĞ', '#a855f7', this)" class="cat-btn bg-purple-500">ğŸ¨ Ğ¡Ğ¾Ğ½</button>
                        <button onclick="toggleCat('park', 'ĞŸĞĞ Ğš', '#22c55e', this)" class="cat-btn bg-green-500">ğŸŒ³ ĞŸĞ°Ñ€Ğº</button>
                        <button onclick="toggleCat('hospital', 'SOS', '#10b981', this)" class="cat-btn bg-emerald-500">ğŸ¥ SOS</button>
                        <button onclick="toggleCat('police', 'ĞšĞĞŸĞ«', '#1e40af', this)" class="cat-btn bg-blue-800">ğŸ‘® ĞšĞ¾Ğ¿Ñ‹</button> 
                        <button onclick="toggleCat('restaurant', 'Ğ•Ğ”Ğ', '#ef4444', this)" class="cat-btn bg-red-600">ğŸ± Ğ•Ğ´Ğ°</button>
                        <button onclick="toggleCat('bus_stop', 'ĞĞ’Ğ¢Ğ', '#64748b', this)" class="cat-btn bg-slate-500">ğŸšŒ ĞĞ²Ñ‚Ğ¾</button>
                    </div>

                    <button id="goBtn" onclick="buildRoadRoute()" class="btn-main w-full mt-6 p-5 rounded-2xl font-black text-xl uppercase italic shadow-xl transition-all active:scale-95">
                        ĞŸĞ ĞĞ›ĞĞ–Ğ˜Ğ¢Ğ¬ ĞŸĞ£Ğ¢Ğ¬ ğŸš€
                    </button>
                </div>

                <div id="list-card" class="glass-card p-6 hidden max-h-[150px] overflow-y-auto">
                    <h3 class="text-xs font-black uppercase text-blue-500 mb-3 tracking-widest">ĞœĞµÑÑ‚Ğ° Ğ¿Ğ¾ Ğ¿ÑƒÑ‚Ğ¸:</h3>
                    <div id="res-list" class="space-y-2 text-[11px] font-bold border-l border-blue-200 pl-4 text-slate-700"></div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-4">
                <div id="map"></div>

                <div id="stats-panel" class="glass-card p-6 hidden flex justify-around items-center border-b-4 border-blue-400">
                    <div class="text-center">
                        <p class="text-[10px] font-black text-gray-400 uppercase">Ğ”Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ</p>
                        <p id="route-dist" class="text-3xl font-black text-slate-800 italic">0.0 ĞºĞ¼</p>
                    </div>
                    <div class="text-center">
                        <p class="text-[10px] font-black text-gray-400 uppercase">Ğ’Ñ€ĞµĞ¼Ñ</p>
                        <p id="route-time" class="text-3xl font-black text-blue-600 italic">0 Ğ¼Ğ¸Ğ½</p>
                    </div>
                    <button onclick="orderTaxi()" class="bg-yellow-400 text-black px-6 py-3 rounded-2xl font-black uppercase text-xs flex items-center gap-2 hover:scale-105 transition-all shadow-md">
                        Ğ—Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚Ğ°ĞºÑĞ¸ ğŸš•
                    </button>
                </div>
            </div>
        </div>
        <div class="text-center mt-10">
            <p class="text-white text-sm font-bold opacity-50">â¬‡ï¸ Ğ›Ğ¸ÑÑ‚Ğ°Ğ¹ Ğ²Ğ½Ğ¸Ğ· Ğ´Ğ»Ñ 3D Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° â¬‡ï¸</p>
        </div>
    </div>

    <!-- ============================================== -->
    <!-- Ğ§ĞĞ¡Ğ¢Ğ¬ 2: 3D Ğ“Ğ›ĞĞ‘Ğ£Ğ¡ -->
    <!-- ============================================== -->
    <div id="globe-section">
        <div id="globe-controls">
            <h3> 3D ĞŸĞ¾Ğ»Ñ‘Ñ‚</h3>
            
            <!-- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ -->
            <div id="status-msg" style="color: orange;">â³ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° 3D Ğ´Ğ²Ğ¸Ğ¶ĞºĞ°...</div>

            <label>ĞÑ‚ĞºÑƒĞ´Ğ°:</label>
            <select id="start-select">
                <option value="55.7558,37.6173,Moscow">ğŸ‡·ğŸ‡º ĞœĞ¾ÑĞºĞ²Ğ°</option>
                <option value="39.9042,116.4074,Beijing">ğŸ‡¨ğŸ‡³ ĞŸĞµĞºĞ¸Ğ½</option>
                <option value="40.7128,-74.0060,New York">ğŸ‡ºğŸ‡¸ ĞÑŒÑ-Ğ™Ğ¾Ñ€Ğº</option>
                <option value="51.5074,-0.1278,London">ğŸ‡¬ğŸ‡§ Ğ›Ğ¾Ğ½Ğ´Ğ¾Ğ½</option>
                <option value="25.2048,55.2708,Dubai">ae Ğ”ÑƒĞ±Ğ°Ğ¹</option>
                <option value="34.0522,-118.2437,Los Angeles">ğŸ‡ºğŸ‡¸ Ğ›Ğ¾Ñ-ĞĞ½Ğ´Ğ¶ĞµĞ»ĞµÑ</option>
                <option value="-33.8688,151.2093,Sydney">au Ğ¡Ğ¸Ğ´Ğ½ĞµĞ¹</option>
                <option value="42.8746,74.5698,Bishkek">ğŸ‡°ğŸ‡¬ Ğ‘Ğ¸ÑˆĞºĞµĞº</option>
                <option value="43.2389,76.8897,Almaty">ğŸ‡°z ĞĞ»Ğ¼Ğ°Ñ‚Ñ‹</option>
                <option value="59.9343,30.3351,St. Petersburg">ğŸ‡·ğŸ‡º Ğ¡Ğ°Ğ½ĞºÑ‚-ĞŸĞµÑ‚ĞµÑ€Ğ±ÑƒÑ€Ğ³</option>
                <option value="35.6762,139.6503,Tokyo">ğŸ‡¯ğŸ‡µ Ğ¢Ğ¾ĞºĞ¸Ğ¾</option>
                <option value="48.8566,2.3522,Paris">ğŸ‡«ğŸ‡· ĞŸĞ°Ñ€Ğ¸Ğ¶</option>
                <option value="52.5200,13.4050,Berlin">ğŸ‡©ğŸ‡ª Ğ‘ĞµÑ€Ğ»Ğ¸Ğ½</option>
                <option value="-22.9068,-43.1729,Rio">ğŸ‡§ğŸ‡· Ğ Ğ¸Ğ¾-Ğ´Ğµ-Ğ–Ğ°Ğ½ĞµĞ¹Ñ€Ğ¾</option>
                <option value="41.0082,28.9784,Istanbul">ğŸ‡¹ğŸ‡· Ğ¡Ñ‚Ğ°Ğ¼Ğ±ÑƒĞ»</option>
                <option value="30.0444,31.2357,Cairo">ğŸ‡ªğŸ‡¬ ĞšĞ°Ğ¸Ñ€</option>
                <option value="31.2304,121.4737,Shanghai">ğŸ‡¨ğŸ‡³ Ğ¨Ğ°Ğ½Ñ…Ğ°Ğ¹</option>
                <option value="37.5665,126.9780,Seoul">ğŸ‡°ğŸ‡· Ğ¡ĞµÑƒĞ»</option>
                <option value="51.1605,71.4704,Astana">ğŸ‡°z ĞÑÑ‚Ğ°Ğ½Ğ°</option>
                <option value="41.2995,69.2401,Tashkent">ğŸ‡ºz Ğ¢Ğ°ÑˆĞºĞµĞ½Ñ‚</option>
                <option value="41.9028,12.4964,Rome">ğŸ‡®ğŸ‡¹ Ğ Ğ¸Ğ¼</option>
                <option value="40.4168,-3.7038,Madrid">ğŸ‡ªğŸ‡¸ ĞœĞ°Ğ´Ñ€Ğ¸Ğ´</option>
                <option value="41.3851,2.1734,Barcelona">ğŸ‡ªğŸ‡¸ Ğ‘Ğ°Ñ€ÑĞµĞ»Ğ¾Ğ½Ğ°</option>
                <option value="45.4408,12.3155,Venice">ğŸ‡®ğŸ‡¹ Ğ’ĞµĞ½ĞµÑ†Ğ¸Ñ</option>
                <option value="4.1755,73.5093,Maldives">mv ĞœĞ°Ğ»ÑŒĞ´Ğ¸Ğ²Ñ‹</option>
            </select>

            <label>ĞšÑƒĞ´Ğ°:</label>
<select id="end-select">
    <option value="55.7558,37.6173,Moscow">ğŸ‡·ğŸ‡º ĞœĞ¾ÑĞºĞ²Ğ°</option>
    <option value="39.9042,116.4074,Beijing">ğŸ‡¨ğŸ‡³ ĞŸĞµĞºĞ¸Ğ½</option>
    <option value="40.7128,-74.0060,New York">ğŸ‡ºğŸ‡¸ ĞÑŒÑ-Ğ™Ğ¾Ñ€Ğº</option>
    <option value="51.5074,-0.1278,London">ğŸ‡¬ğŸ‡§ Ğ›Ğ¾Ğ½Ğ´Ğ¾Ğ½</option>
    <option value="25.2048,55.2708,Dubai">ae Ğ”ÑƒĞ±Ğ°Ğ¹</option>
    <option value="34.0522,-118.2437,Los Angeles">ğŸ‡ºğŸ‡¸ Ğ›Ğ¾Ñ-ĞĞ½Ğ´Ğ¶ĞµĞ»ĞµÑ</option>
    <option value="-33.8688,151.2093,Sydney">au Ğ¡Ğ¸Ğ´Ğ½ĞµĞ¹</option>
    <option value="42.8746,74.5698,Bishkek">ğŸ‡°ğŸ‡¬ Ğ‘Ğ¸ÑˆĞºĞµĞº</option>
    <option value="43.2389,76.8897,Almaty">ğŸ‡°z ĞĞ»Ğ¼Ğ°Ñ‚Ñ‹</option>
    <option value="59.9343,30.3351,St. Petersburg">ğŸ‡·ğŸ‡º Ğ¡Ğ°Ğ½ĞºÑ‚-ĞŸĞµÑ‚ĞµÑ€Ğ±ÑƒÑ€Ğ³</option>
    <option value="35.6762,139.6503,Tokyo">ğŸ‡¯ğŸ‡µ Ğ¢Ğ¾ĞºĞ¸Ğ¾</option>
    <option value="48.8566,2.3522,Paris">ğŸ‡«ğŸ‡· ĞŸĞ°Ñ€Ğ¸Ğ¶</option>
    <option value="52.5200,13.4050,Berlin">ğŸ‡©ğŸ‡ª Ğ‘ĞµÑ€Ğ»Ğ¸Ğ½</option>
    <option value="-22.9068,-43.1729,Rio">ğŸ‡§ğŸ‡· Ğ Ğ¸Ğ¾-Ğ´Ğµ-Ğ–Ğ°Ğ½ĞµĞ¹Ñ€Ğ¾</option>
    <option value="41.0082,28.9784,Istanbul">ğŸ‡¹ğŸ‡· Ğ¡Ñ‚Ğ°Ğ¼Ğ±ÑƒĞ»</option>
    <option value="30.0444,31.2357,Cairo">ğŸ‡ªğŸ‡¬ ĞšĞ°Ğ¸Ñ€</option>
    <option value="31.2304,121.4737,Shanghai">ğŸ‡¨ğŸ‡³ Ğ¨Ğ°Ğ½Ñ…Ğ°Ğ¹</option>
    <option value="37.5665,126.9780,Seoul">ğŸ‡°ğŸ‡· Ğ¡ĞµÑƒĞ»</option>
    <option value="51.1605,71.4704,Astana">ğŸ‡°z ĞÑÑ‚Ğ°Ğ½Ğ°</option>
    <option value="41.2995,69.2401,Tashkent">ğŸ‡ºz Ğ¢Ğ°ÑˆĞºĞµĞ½Ñ‚</option>
    <option value="41.9028,12.4964,Rome">ğŸ‡®ğŸ‡¹ Ğ Ğ¸Ğ¼</option>
    <option value="40.4168,-3.7038,Madrid">ğŸ‡ªğŸ‡¸ ĞœĞ°Ğ´Ñ€Ğ¸Ğ´</option>
    <option value="41.3851,2.1734,Barcelona">ğŸ‡ªğŸ‡¸ Ğ‘Ğ°Ñ€ÑĞµĞ»Ğ¾Ğ½Ğ°</option>
    <option value="45.4408,12.3155,Venice">ğŸ‡®ğŸ‡¹ Ğ’ĞµĞ½ĞµÑ†Ğ¸Ñ</option>
    <option value="4.1755,73.5093,Maldives">mv ĞœĞ°Ğ»ÑŒĞ´Ğ¸Ğ²Ñ‹</option>
</select>

            <button id="btn-run" onclick="runGlobeRoute()" disabled>Ğ–Ğ´Ñƒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸...</button>
        </div>
        <div id="globeViz"></div>
    </div>

    <!-- ============================================== -->
    <!-- Ğ¡ĞšĞ Ğ˜ĞŸĞ¢Ğ« -->
    <!-- ============================================== -->
    <script>
        // === Ğ¡ĞšĞ Ğ˜ĞŸĞ¢ 1: NOMAD GO (2D) ===
        // Ğ“Ğ•ĞĞ•Ğ ĞĞ¦Ğ˜Ğ¯ Ğ¡ĞœĞĞ™Ğ›Ğ˜ĞšĞĞ’ ĞĞ Ğ¤ĞĞĞ•
        const emojis = ['ğŸ„', 'ğŸª', 'â›„', 'ğŸ…', 'ğŸ', 'â„ï¸'];
        const snowContainer = document.getElementById('snow-container');
        for (let i = 0; i < 50; i++) {
            const span = document.createElement('span');
            span.className = 'tiny-emoji';
            span.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            span.style.left = Math.random() * 100 + 'vw';
            span.style.top = Math.random() * 100 + 'vh';
            span.style.fontSize = (Math.random() * 15 + 10) + 'px';
            span.style.animationDelay = Math.random() * 10 + 's';
            snowContainer.appendChild(span);
        }

        let map, routingControl, markers = [], userMarker, watchID = null;
        let startCoords = null, endCoords = null;
        let selectedCats = [{type:'tourism', label:'Ğ“Ğ˜Ğ”', color:'#3b82f6'}];

        function initNomadMap() {
            map = L.map('map', { zoomControl: false, attributionControl: false }).setView([42.87, 74.59], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
        }

        function toggleGPS() {
            const btn = document.getElementById('gpsBtn');
            const input = document.getElementById('startInput');
            const homeAloneHeroes = [
                { name: 'ĞšĞµĞ²Ğ¸Ğ½', img: 'kevin.jpg' },
                { name: 'Ğ“Ğ°Ñ€Ñ€Ğ¸', img: 'garry.jpg' },
                { name: 'ĞœĞ°Ñ€Ğ²', img: 'marv.jpg' },
                { name: 'ĞĞ»Ğ°Ñ„', img: 'Ğ¾Ğ»Ğ°Ñ„.jpg' },
                { name: 'Ğ¡Ğ°Ğ½Ñ‚Ğ°', img: 'santa.jpg' }
            ];
            
            const hero = homeAloneHeroes[Math.floor(Math.random() * homeAloneHeroes.length)];

            if (watchID) {
                navigator.geolocation.clearWatch(watchID); 
                watchID = null;
                btn.classList.replace('bg-blue-600', 'bg-blue-500'); 
                input.value = "";
                startCoords = null;
                if (userMarker) map.removeLayer(userMarker);
                userMarker = null;
            } else {
                btn.classList.replace('bg-blue-500', 'bg-blue-600'); 
                input.value = "ğŸ“ ĞœĞ¾Ñ‘ Ğ¼ĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ";
                
                watchID = navigator.geolocation.watchPosition(pos => {
                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;
                    startCoords = { lat, lon };
                    
                    const markerHtml = `
                        <div class="avatar-container" style="position: relative;">
                            <div class="user-avatar-img" style="background-image: url('${hero.img}');">
                                <div class="char-name-tag">${hero.name}</div>
                            </div>
                        </div>`;
                    
                    if (!userMarker) {
                        userMarker = L.marker([lat, lon], { 
                            icon: L.divIcon({ 
                                className: 'custom-photo-marker', 
                                html: markerHtml,
                                iconSize: [60, 60],
                                iconAnchor: [30, 30]
                            }) 
                        }).addTo(map);
                        map.setView([lat, lon], 15);
                    } else { 
                        userMarker.setLatLng([lat, lon]);
                    }
                }, null, { enableHighAccuracy: true });
            }
        }

        function toggleCat(type, label, color, btn) {
            const index = selectedCats.findIndex(c => c.type === type);
            if (index > -1) { selectedCats.splice(index, 1); btn.classList.remove('active'); }
            else { selectedCats.push({ type, label, color }); btn.classList.add('active'); }
        }

        async function getLatLon(query) {
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
            const data = await res.json();
            return data.length ? { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) } : null;
        }

        async function buildRoadRoute() {
            const btn = document.getElementById('goBtn'); btn.innerText = "Ğ¡Ğ¢Ğ ĞĞ˜Ğœ... âœ¨";
            const startVal = document.getElementById('startInput').value;
            const endVal = document.getElementById('endInput').value;

            if (routingControl) map.removeControl(routingControl);
            markers.forEach(m => map.removeLayer(m)); markers = [];
            document.getElementById('res-list').innerHTML = "";

            let waypoints = [];
            let finalStart = null;
            if (watchID && startCoords) {
                finalStart = L.latLng(startCoords.lat, startCoords.lon);
            } else {
                const resStart = await getLatLon(startVal || "Ğ‘Ğ¸ÑˆĞºĞµĞº");
                if (resStart) finalStart = L.latLng(resStart.lat, resStart.lon);
            }

            if (finalStart) waypoints.push(finalStart);

            const basePoint = finalStart || {lat: 42.87, lng: 74.59};
            for (let cat of selectedCats) {
                const delta = 0.05;
                const url = `https://nominatim.openstreetmap.org/search?format=json&q=${cat.type}&viewbox=${basePoint.lng-delta},${basePoint.lat+delta},${basePoint.lng+delta},${basePoint.lat-delta}&bounded=1&limit=3`;
                try {
                    const poiData = await (await fetch(url)).json();
                    poiData.forEach(p => {
                        const lat = parseFloat(p.lat), lon = parseFloat(p.lon);
                        waypoints.push(L.latLng(lat, lon));
                        const m = L.marker([lat, lon], {
                            icon: L.divIcon({ className: 'label', html: `<div class="map-label" style="border-color:${cat.color}">${cat.label}</div>` })
                        }).addTo(map);
                        markers.push(m);
                        document.getElementById('res-list').innerHTML += `<div><span style="color:${cat.color}">â—</span> ${p.display_name.split(',')[0]}</div>`;
                    });
                } catch(e) {}
            }

            if (endVal) {
                endCoords = await getLatLon(endVal);
                if (endCoords) {
                    waypoints.push(L.latLng(endCoords.lat, endCoords.lon));
                    markers.push(L.marker([endCoords.lat, endCoords.lon], { icon: L.divIcon({ className: 'label', html: `<div class="map-label" style="background:#ef4444; color:white">Ğ¤Ğ˜ĞĞ˜Ğ¨ ğŸ</div>` }) }).addTo(map));
                }
            }

            if (waypoints.length > 1) {
                routingControl = L.Routing.control({
                    waypoints: waypoints,
                    lineOptions: { styles: [{ color: '#3b82f6', opacity: 0.7, weight: 6 }] },
                    createMarker: () => null,
                    addWaypoints: false
                }).on('routesfound', function(e) {
                    const s = e.routes[0].summary;
                    document.getElementById('stats-panel').classList.remove('hidden');
                    document.getElementById('route-dist').innerText = (s.totalDistance / 1000).toFixed(1) + " ĞºĞ¼";
                    document.getElementById('route-time').innerText = Math.round(s.totalTime / 60) + " Ğ¼Ğ¸Ğ½";
                }).addTo(map);
            }

            document.getElementById('list-card').classList.toggle('hidden', markers.length === 0);
            btn.innerText = "ĞŸĞ£Ğ¢Ğ¬ Ğ“ĞĞ¢ĞĞ’! ğŸï¸";
        }

        function orderTaxi() {
            if (!endCoords) return alert("Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ¤Ğ¸Ğ½Ğ¸Ñˆ!");
            const lat = endCoords.lat, lon = endCoords.lon;
            const destName = encodeURIComponent(document.getElementById('endInput').value || "Ğ¤Ğ¸Ğ½Ğ¸Ñˆ");
            const isCIS = confirm("Ğ’Ñ‹ Ğ² Ğ¡ĞĞ“? (OK - Ğ¯Ğ½Ğ´ĞµĞºÑ Go, ĞÑ‚Ğ¼ĞµĞ½Ğ° - Uber)");
            if (isCIS) {
                window.open(`https://3.redirect.appmetrica.yandex.com/route?end-lat=${lat}&end-lon=${lon}&text=${destName}&ref=nomadgo&appmetrica_tracking_id=1178268795219780156`, '_blank');
            } else {
                window.open(`https://m.uber.com/ul/?action=setPickup&dropoff[latitude]=${lat}&dropoff[longitude]=${lon}&dropoff[nickname]=${destName}`, '_blank');
            }
        }

        // === Ğ¡ĞšĞ Ğ˜ĞŸĞ¢ 2: 3D Ğ“Ğ›ĞĞ‘Ğ£Ğ¡ ===
        let world;
        
        function initGlobe() {
            const statusDiv = document.getElementById('status-msg');
            const btn = document.getElementById('btn-run');

            if (typeof Globe === 'undefined') {
                statusDiv.innerHTML = "âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ğ° Ğ¸Ğ»Ğ¸ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.";
                statusDiv.style.color = "red";
                return;
            }

            try {
                world = Globe()
                  .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
                  .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
                  .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
                  // ğŸ… Ğ¡Ñ‚Ğ¸Ğ»ÑŒ "ĞŸÑƒÑ‚ÑŒ Ğ¡Ğ°Ğ½Ñ‚Ñ‹" (Red & White)
                  .arcColor(() => ['#ff0000', '#ffffff', '#ff0000']) // Ğ“Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚: ĞšÑ€Ğ°ÑĞ½Ñ‹Ğ¹ -> Ğ‘ĞµĞ»Ñ‹Ğ¹ -> ĞšÑ€Ğ°ÑĞ½Ñ‹Ğ¹
                  .arcStroke(3)               // Ğ›Ğ¸Ğ½Ğ¸Ñ Ñ‡ÑƒÑ‚ÑŒ Ñ‚Ğ¾Ğ»Ñ‰Ğµ
                  .arcDashLength(0.4)         // Ğ”Ğ»Ğ¸Ğ½Ğ° ÑˆÑ‚Ñ€Ğ¸Ñ…Ğ°
                  .arcDashGap(0.1)            // ĞŸÑ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚ĞºĞ¸ Ğ¼ĞµĞ½ÑŒÑˆĞµ (Ğ»Ğ¸Ğ½Ğ¸Ñ Ğ¿Ğ»Ğ¾Ñ‚Ğ½ĞµĞµ)
                  .arcDashAnimateTime(1500)   // Ğ›ĞµÑ‚Ğ¸Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ!
                  (document.getElementById('globeViz'));

                statusDiv.innerHTML = "âœ… Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ Ğ“ĞĞ¢ĞĞ’Ğ";
                statusDiv.style.color = "green";
                btn.disabled = false;
                btn.innerText = "ğŸš€ ĞŸĞĞ›Ğ•Ğ¢Ğ•Ğ›Ğ˜";
            } catch (error) {
                console.error(error);
                statusDiv.innerHTML = "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ ĞºĞ°Ñ€Ñ‚Ñ‹";
                statusDiv.style.color = "red";
            }
        }

        function runGlobeRoute() {
            try {
                const startVal = document.getElementById('start-select').value.split(',');
                const endVal = document.getElementById('end-select').value.split(',');

                const startLoc = { lat: parseFloat(startVal[0]), lng: parseFloat(startVal[1]), name: startVal[2] };
                const endLoc = { lat: parseFloat(endVal[0]), lng: parseFloat(endVal[1]), name: endVal[2] };

                world.arcsData([]);
                world.labelsData([]);

                const routeData = [{
                    startLat: startLoc.lat,
                    startLng: startLoc.lng,
                    endLat: endLoc.lat,
                    endLng: endLoc.lng
                }];

                world.arcsData(routeData);

                const labelsData = [
                    { lat: startLoc.lat, lng: startLoc.lng, text: startLoc.name },
                    { lat: endLoc.lat, lng: endLoc.lng, text: endLoc.name }
                ];

                world.labelsData(labelsData)
    .labelLat(d => d.lat)
    .labelLng(d => d.lng)
    .labelText(d => d.text) // <--- Ğ­Ğ¢Ğ Ğ¡Ğ¢Ğ ĞĞšĞ ĞĞ¢Ğ’Ğ•Ğ§ĞĞ•Ğ¢ Ğ—Ğ Ğ¢Ğ•ĞšĞ¡Ğ¢
    .labelSize(1.5)
    .labelDotRadius(0.8)
    .labelColor(() => 'white');
                const midLat = (startLoc.lat + endLoc.lat) / 2;
                const midLng = (startLoc.lng + endLoc.lng) / 2;
                world.pointOfView({ lat: midLat, lng: midLng, altitude: 2.0 }, 1500);

            } catch (e) {
                alert("Ğ§Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ¿Ğ¾ÑˆĞ»Ğ¾ Ğ½Ğµ Ñ‚Ğ°Ğº: " + e.message);
            }
        }

        // Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ’Ğ¡Ğ•Ğ“Ğ ĞŸĞ Ğ˜ Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ•
        window.onload = function() {
            initNomadMap(); // Ğ—Ğ°Ğ¿ÑƒÑĞº 2D ĞºĞ°Ñ€Ñ‚Ñ‹
            initGlobe();    // Ğ—Ğ°Ğ¿ÑƒÑĞº 3D Ğ³Ğ»Ğ¾Ğ±ÑƒÑĞ°
        };
    </script>
</body>
</html>